<%- include('header') %>

  <div class="container">
    <div class="row">
      <div class="col-md-12 d-flex align-items-center justify-content-center flex-column">
          <img class="rounded-circle shadow " width="300" height="300" src="<%= user.pic %>" alt="">
          <h2><%= user.username %></h2>
          <p><%= user.info %></p>

      </div>
    </div>
    <% if(session.user) { %>
      <div class="row">
        <% if(errors){ errors.forEach(err=>{ %>
          <span class="alert alert-danger"> <%= err.msg %></span>
        <% }) } %>
      </div>
    <% } %>
    <div class="row">
      <% if(images && images.length){ images.forEach((img)=>{ %>
        <div class="col-md-4 p-1">
          <div class="shadow py-2 px-1">
            <a href="/photos/<%= img._id %>">
              <img loading="lazy" width="100%" height="300" src="<%= img.image %>" alt="<%= img.title %>">
            </a>
            <div class="d-flex justify-content-between alig-items-center">
              <h3><a href="/photos/<%= img._id %>"><%= img.title %></a></h3>
              <span>
                <svg height="18" viewBox="0 0 24 24" width="20" >
                  <g>
                    <path d="m12 21c-5.196 0-9.815-3.067-11.767-7.814-.31-.753-.31-1.618 0-2.371 1.952-4.748 6.571-7.815 11.767-7.815s9.815 3.067 11.767 7.814c.31.753.31 1.618 0 2.371-1.952 4.748-6.571 7.815-11.767 7.815zm0-17c-4.789 0-9.045 2.824-10.842 7.194-.21.512-.21 1.099 0 1.611 1.797 4.371 6.053 7.195 10.842 7.195s9.045-2.824 10.842-7.194c.21-.512.21-1.099 0-1.611-1.797-4.371-6.053-7.195-10.842-7.195z"/>
                  </g>
                  <g>
                    <path d="m12 16c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4zm0-7c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"/>
                  </g>
                </svg>
                <%= img.views %>
              </span>
            </div>
            <% if(session.user && session.user._id == img.user_id._id) { %>
              <button class="delete-image btn btn-danger m-1" data-id="<%= img._id %>" >Delete</button>
            <% } %>
          </div>
        </div>
      <% }) }else {%>
        <div class="col-md-12">
          <p>there is no images yet</p>
        </div>
      <% } %>
    </div>
  </div>

  <% if(session.user){ %>
    <script>
      function deletImage(e){
        imgId = e.target.dataset.id;
        fetch('/photos/' + imgId, {
          method: 'POST'
        }).then(data => {
          e.target.parentElement.parentElement.style.display = 'none';
        })
        .catch((err)=>{
          console.log(err);
        })
      }
      let deleteBtns = document.querySelectorAll('.delete-image');
      if(deleteBtns && deleteBtns.length){
        deleteBtns.forEach(btn=>{
          btn.addEventListener('click', deletImage);
        })
      }
    </script>
  <% } %>
<%- include('footer') %>
